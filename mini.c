#include"stdio.h"
#include"stdlib.h"
#include"stdbool.h"
#define _a if(_b<13)PR[_b++]=
#define _d(_e)if(_f->_e==0){_f->_e=_g(_f,0);_a _f->_e;}
#define _h(_e)if(_f->_i==0){_d(_i);_f->_i->_i=0;_f->_i->_e=_f;}
#define _j(fn)if(_f->_l==0){_f->_l=_g(_f,_n());_a _f->_l;}if(_f->_m==0){_f->_m=_g(_f,_n());_a _f->_m;}_f->_o=fn(_f->_l->_o,_f->_m->_o);
#define L long long int
#define _k struct Node
_k{_k*_i;_k*_l;_k*_m;L _o;};L _n(){L x;scanf("%lld",&x);return x;}_k*_g(_k*_i,L _o){_k*_p=malloc(sizeof(_k));_p->_i=_i;_p->_l=0;_p->_m=0;_p->_o=_o;return _p;}void __q(_k*_r,_k*_p,int _s){if(_r==0){for(int i=0;i<_s;i++)printf("|--");puts("(null)");return;}if(_r->_l!=0||_r->_m!=0)__q(_r->_l,_p,_s+1);for(int i=0;i<_s;i++)printf("|--");printf("%lld(%p)",_r->_o,_r);if(_r==_p)printf("*");puts("");if(_r->_l!=0||_r->_m!=0)__q(_r->_m,_p,_s+1);}void _q(_k*_p){_k*_t=_p;while(_p->_i)_p=_p->_i;__q(_p,_t,0);}L add(L x,L y){return x+y;}L sub(L x,L y){return x-y;}L mul(L x,L y){return x*y;}L dvd(L x,L y){if(y==0)return 0;return x/y;}L mod(L x,L y){if(y==0)return 0;return x%y;}L lt(L x,L y){return x<y ? 1 : 0;}L gt(L x,L y){return x>y ? 1 : 0;}L and(L x,L y){return x&y;}L or(L x,L y){return x|y;}int main(int _u,char**_v){if(_u<2){puts("You have not entered any code! The code should go in the first command line argument.");return-1;}char*_w=_v[1];int _x=0;int _y=0;int _z=0;while(_w[_z]){if(_w[_z]=='['){_x++;_y++;}else if(_w[_z]==']'){_y--;if(_y<0){puts("Your brackets are not balanced(missing open bracket)!");return-1;}}_z++;}if(_y>0){puts("Your brackets are not balanced(missing close bracket)!");return-1;}int _A=_z-1;int _B[_A];int _D[_A];int stack[_x];int stack_z=0;_z=0;while(_w[_z]){if(_w[_z]=='['){stack[stack_z++]=_z;}else if(_w[_z]==']'){_B[stack[--stack_z]]=_z;_D[_z]=stack[stack_z];}_z++;}_z=0;int VR[13]={0};bool SR[13]={false};_k*PR[13]={0};int _b=1;_k*_f=_g(0,0);if(_u>=3){VR[0]=_f->_o=atoi(_v[2]);SR[0]=true;}PR[0]=_f;for(int argi=3;argi<_u;argi++){_f=_f->_l=_g(_f,atoi(_v[argi]));if(argi<15){VR[argi-2]=_f->_o;SR[argi-2]=true;}}while(_f->_i!=0)_f=_f->_i;while(_w[_z]){if(_w[_z]>='0'&&_w[_z]<='9'){_f->_o=_w[_z]-'0';}else if(_w[_z]=='.'){printf("%c",(char)_f->_o);}else if(_w[_z]=='#'){printf("%lld",_f->_o);}else if(_w[_z]==','){_f->_o=(long long int)getchar();}else if(_w[_z]=='$'){_f->_o=_n();}else if(_w[_z]=='^'){_h(_l);_f=_f->_i;}else if(_w[_z]=='/'){_d(_l);_f=_f->_l;}else if(_w[_z]=='\\'){_d(_m);_f=_f->_m;}else if(_w[_z]==';'){_h(_l);_f->_o=_f->_i->_o;}else if(_w[_z]=='+'){_j(add);}else if(_w[_z]=='-'){_j(sub);}else if(_w[_z]=='*'){_j(mul);}else if(_w[_z]==':'){_j(dvd);}else if(_w[_z]=='%'){_j(mod);}else if(_w[_z]=='<'){_j(lt);}else if(_w[_z]=='>'){_j(gt);}else if(_w[_z]=='&'){_j(and);}else if(_w[_z]=='|'){_j(or);}else if(_w[_z]=='~'){_f->_o=~_f->_o;}else if(_w[_z]=='!'){_f->_o=_f->_o==0 ? 1 : 0;}else if(_w[_z]=='_'){_f->_o=-_f->_o;}else if(_w[_z]=='@'){_d(_l);_d(_m);L _F=_f->_l->_o;_f->_l->_o=_f->_m->_o;_f->_m->_o=_F;}else if(_w[_z]=='?'){if(_f->_o==0){_d(_l);_f=_f->_l;}else{_d(_m);_f=_f->_m;}}else if(_w[_z]=='['){if(_f->_o==0){_z=_B[_z];}}else if(_w[_z]==']'){if(_f->_o!=0){_z=_D[_z];}}else if(_w[_z]>='A'&&_w[_z]<='M'){PR[_w[_z]-'A']=_f;_b=13;}else if(_w[_z]>='a'&&_w[_z]<='m'){if(PR[_w[_z]-'a']!=0){_f=PR[_w[_z]-'a'];}}else if(_w[_z]>='N'&&_w[_z]<='Z'){VR[_w[_z]-'N']=_f->_o;SR[_w[_z]-'N']=true;}else if(_w[_z]>='n'&&_w[_z]<='z'){if(SR[_w[_z]-'n']){_f->_o=VR[_w[_z]-'n'];}}else if(_w[_z]=='('){_h(_m);if(_f==_f->_i->_m){_k*a=_f->_i->_l;_k*b=_f->_l;_k*c=_f->_m;L _E=_f->_i->_o;_f->_i->_o=_f->_o;_f=_f->_i;_f->_l=_f->_m;_f->_l->_o=_E;_f->_l->_l=a;_f->_l->_m=b;_f->_m=c;}else{_d(_m);_d(_l);int t=_f->_o;_f->_o=_f->_m->_o;_f->_m->_o=_f->_l->_o;_f->_l->_o=t;_f=_f->_l;}}else if(_w[_z]==')'){_h(_l);if(_f==_f->_i->_l){_k*a=_f->_l;_k*b=_f->_m;_k*c=_f->_i->_m;L _E=_f->_i->_o;_f->_i->_o=_f->_o;_f=_f->_i;_f->_m=_f->_l;_f->_l->_o=_E;_f->_m->_l=b;_f->_m->_m=c;_f->_l=a;}else{_d(_l);_d(_m);int t=_f->_o;_f->_o=_f->_l->_o;_f->_l->_o=_f->_m->_o;_f->_m->_o=t;_f=_f->_m;}}else if(_w[_z]=='{'){_h(_l);_d(_m);L _F=_f->_i->_o;_f->_i->_o=_f->_m->_o;_f->_m->_o=_F;}else if(_w[_z]=='}'){_h(_m);_d(_l);L _F=_f->_i->_o;_f->_i->_o=_f->_l->_o;_f->_l->_o=_F;}else if(_w[_z]=='\"'){_k*_C=_g(_f,0);_C->_l=_f->_l;_C->_m=_f->_m;_f->_l=0;_f->_m=_C;_a _C;}else if(_w[_z]=='\''){_k*_C=_g(_f,0);_C->_l=_f->_l;_C->_m=_f->_m;_f->_m=0;_f->_l=_C;_a _C;}else if(_w[_z]=='`'){_q(_f);}_z++;}}
